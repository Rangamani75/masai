import React, { useState } from "react";
import ReactDOM from "react-dom/client";
import { ChakraProvider, Box, Input, Button, VStack, HStack, Text, Checkbox } from "@chakra-ui/react";
import { createStore } from "redux";
import { Provider, useDispatch, useSelector } from "react-redux";

const ADD_TODO = "ADD_TODO";
const TOGGLE_TODO = "TOGGLE_TODO";
const DELETE_TODO = "DELETE_TODO";

const addTodo = (title) => ({ type: ADD_TODO, payload: { title } });
const toggleTodo = (id) => ({ type: TOGGLE_TODO, payload: { id } });
const deleteTodo = (id) => ({ type: DELETE_TODO, payload: { id } });

const initialState = { todos: [] };

const reducer = (state = initialState, action) => {
  switch (action.type) {
    case ADD_TODO:
      return {
        todos: [
          ...state.todos,
          { id: Date.now(), title: action.payload.title, status: false }
        ]
      };
    case TOGGLE_TODO:
      return {
        todos: state.todos.map((todo) =>
          todo.id === action.payload.id
            ? { ...todo, status: !todo.status }
            : todo
        )
      };
    case DELETE_TODO:
      return {
        todos: state.todos.filter((todo) => todo.id !== action.payload.id)
      };
    default:
      return state;
  }
};

const store = createStore(reducer);

function TodoApp() {
  const [title, setTitle] = useState("");
  const todos = useSelector((state) => state.todos);
  const dispatch = useDispatch();

  return (
    <Box maxW="400px" mx="auto" mt="8">
      <HStack>
        <Input
          placeholder="Enter todo"
          value={title}
          onChange={(e) => setTitle(e.target.value)}
        />
        <Button
          colorScheme="teal"
          onClick={() => {
            if (title.trim()) {
              dispatch(addTodo(title));
              setTitle("");
            }
          }}
        >
          Add
        </Button>
      </HStack>
      <VStack align="stretch" mt="4" spacing="3">
        {todos.map((todo) => (
          <HStack
            key={todo.id}
            p="2"
            borderWidth="1px"
            borderRadius="md"
            justify="space-between"
          >
            <Checkbox
              isChecked={todo.status}
              onChange={() => dispatch(toggleTodo(todo.id))}
            >
              <Text as={todo.status ? "del" : "span"}>{todo.title}</Text>
            </Checkbox>
            <Button
              size="sm"
              colorScheme="red"
              onClick={() => dispatch(deleteTodo(todo.id))}
            >
              Delete
            </Button>
          </HStack>
        ))}
      </VStack>
      <Box mt="4">
        <pre>{JSON.stringify({ todos }, null, 2)}</pre>
      </Box>
    </Box>
  );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(
  <ChakraProvider>
    <Provider store={store}>
      <TodoApp />
    </Provider>
  </ChakraProvider>
);
